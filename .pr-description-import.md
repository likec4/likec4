# feat(cli,playground,docs): Import Draw.io files to LikeC4 source (experimental)

## Summary

This PR adds **import** of [Draw.io](https://draw.io) (`.drawio`) files into LikeC4 source (`.c4`). Users can import via the **CLI** (`likec4 import drawio <file>`) and from the **Playground** (right-click on diagram → DrawIO → Import…). The feature is **experimental**: the import path is implemented and tested for basic and multi-diagram cases but is not yet fully validated for all edge cases; CLI and docs describe it as experimental.

**Prerequisite:** The **Export to Draw.io** feature must already be merged (generators + CLI export + Playground export). This PR builds on that and adds only import-related code.

---

## What’s in this PR

### 1. CLI (`@likec4/likec4`)

- **`packages/likec4/src/cli/import/drawio/handler.ts`** — `likec4 import drawio <input>`: reads a `.drawio` or `.drawio.xml` file, converts it to LikeC4 source using `parseDrawioToLikeC4` / `parseDrawioToLikeC4Multi`, and writes a `.c4` file. Options: `--outfile, -o` for output path. Described in help as **experimental** (import path not yet fully validated).
- **`packages/likec4/src/cli/import/index.ts`** — Registers the `import` command and the drawio subcommand.

### 2. Playground

- **Import in DrawIO menu:**
  - **`apps/playground/src/components/drawio/DrawioContextMenuDropdown.tsx`** — Adds **Import…** menu item and a hidden file input (`accept=".drawio,.drawio.xml,application/x-drawio"`). Props: `onImport`, `onImportFile`, `fileInputRef`.
  - **`apps/playground/src/components/drawio/useDrawioContextMenuActions.ts`** — Adds `handleImport`, `handleImportFile`; uses `parseDrawioToLikeC4` to convert selected file to LikeC4 source and `onAddFile(filename, content)` to add the new `.c4` file to the workspace.
  - **`apps/playground/src/components/drawio/drawio-events.ts`** — `DRAWIO_IMPORT_EVENT` used by the Monaco action.
- **Monaco editor:** **`apps/playground/src/monaco/LanguageClientSync.tsx`** — Registers the **Import from DrawIO…** action in the editor context menu; dispatches `DRAWIO_IMPORT_EVENT` so the Playground can open the file picker and add the generated `.c4` file.

No change to export behaviour; export remains as in the previously merged export PR.

### 3. Documentation

- **`apps/docs/src/content/docs/tooling/drawio.mdx`** — Adds **Import (Draw.io → LikeC4)** section: mapping table (Draw.io → LikeC4), comment blocks for round-trip (layout, stroke color/width, custom data, view notation, edge waypoints), “Not preserved on import”, and note that import round-trip is **implemented but not yet fully tested or approved**. Multi-diagram behaviour (multiple tabs → multiple views) and round-trip summary updated to include import.
- **`apps/docs/src/content/docs/tooling/cli.mdx`** — Adds **Import from DrawIO** section: usage (`likec4 import drawio diagram.drawio`, `-o` for output file), options table, and link to Draw.io integration page. Intro list updated to mention “Import from DrawIO (.drawio → LikeC4)”. The sentence “Together with Export to DrawIO and Import from DrawIO…” (or equivalent) is included where relevant.

### 4. Tests

- **`packages/likec4/src/drawio-demo-export-import.spec.ts`** — **Import/round-trip test is enabled** (no longer skipped): “vice versa: import exported DrawIO back to LikeC4 and re-export produces loadable XML”.
- **`packages/likec4/src/drawio-tutorial-export-import.spec.ts`** — **Import and round-trip tests are enabled**: “imports exported DrawIO XML back to valid LikeC4 source”, “round-trip: exported DrawIO re-imports to .c4 source with model and relationships”, “multi-diagram export re-imports with parseDrawioToLikeC4Multi and produces multiple views”.
- **E2E (optional):** If desired, **`e2e/tests/drawio-playground.spec.ts`** can assert that the DrawIO menu shows **Import from DrawIO** (and Export to DrawIO) so both flows are covered.

No new generator code in this PR; `parse-drawio` and its API are already present from the export PR.

---

## What’s not in this PR

- **Generators:** No new files in `packages/generators/src/drawio/`; only CLI, Playground, docs, and test unskipping.
- **Export:** No changes to export behaviour or export-only docs (already merged).

---

## Experimental status

- **CLI:** `likec4 import drawio` is documented as **experimental** and that the import path is not yet fully validated.
- **Docs:** The Draw.io integration page states that import round-trip is “implemented but not yet fully tested or approved”.
- This allows the feature to land and be used while setting the right expectations; further validation and refinements can follow in later PRs.

---

## Checklist (contribution guidelines)

- [ ] I have read the latest [contribution guidelines](https://github.com/likec4/likec4/blob/main/CONTRIBUTING.md).
- [ ] I have rebased my branch onto `main` **after** the Export-to-Draw.io PR is merged.
- [ ] My commit messages follow the [Conventional Commits](https://www.conventionalcommits.org/) spec (e.g. `feat:`, `docs:`).
- [ ] I have added/updated tests for import (likec4 specs unskipped; e2e updated if applicable).
- [ ] I have run `pnpm test` and `pnpm typecheck` (and `pnpm test:e2e` if e2e changed); all pass.
- [ ] Documentation has been updated (drawio.mdx and cli.mdx for **import** and round-trip).
- [ ] A changeset has been added for user-facing packages (`@likec4/likec4`, `@likec4/docs-astro`, playground if versioned) describing the new import command and experimental status.

---

## Notes for reviewers

- **Scope:** This PR adds only import: CLI command, Playground menu + file input + Monaco action, docs, and enabling import/round-trip tests. Export is unchanged.
- **Parsing:** All parsing logic lives in `@likec4/generators` (from the export PR); this PR only wires CLI and Playground to `parseDrawioToLikeC4` / `parseDrawioToLikeC4Multi`.
- **Experimental:** Both CLI help and docs clearly state that import is experimental and not yet fully validated, so users can try it without assuming production-grade coverage for every Draw.io file.
